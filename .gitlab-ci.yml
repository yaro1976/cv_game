image: node:latest
before_script:
  - apt-get -qq update
  - apt-get -qq install -y python2.7 python2.7-dev build-essential make gcc g++ libicu-dev
  - npm -g install npm node --silent  
  - npm install --silent

stages:
  - test
  - build
  - clean_up

run_tests:
  stage: test
  script:
    - npm i -g karma-cli
    - npm i -g gulp
    - npm test

build_and_deploy_prod:
  stage: build
  script:
    - npm run build

clean_up_job:
  stage: clean_up
  script:
    - rm -rf node_modules
  when: on_failure
    